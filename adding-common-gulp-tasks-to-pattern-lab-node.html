<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="/css/style.css">
  <title> Adding Common Gulp Tasks to Pattern Lab Node || Brian Muenzenmeyer  </title>
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><script src="js/respond.min.js"></script><![endif]-->
</head>
<body>

<header class="masthead">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 34"
    fill="#0D80F0" stroke="#031636" stroke-width="2" class="masthead__logo">
    <title>Gorilla step</title>
    <!-- Designed by Metafizzy, 2017 -->
    <path d="M7 14l-6 6v10h6M23 13l9 9v8h-7l-2-2v-2h-2l-2.5-2.5M16 10a7 7 0 0 1 0 14"/>
    <path d="M15 16l2 2v4l-1 1 1 1v6H7V14l4-4 7-7h3l4 4-1 1 2 2v2l-1 1"/>
    <path fill="none" d="M26 12l-2 2h-3l-2-2V8h5"/>
  </svg>
  <h1 class="masthead__header"><a href="http://brianmuenzenmeyer.com" class="masthead__header__link">Brian<span class="masthead__header__embellish">Muenzenmeyer</span></a></h1>
</header>
<nav class="nav">
  <a href="/archive.html">all articles</a>
  <a href="/about.html">about me</a>
  <a href="https://twitter.com/bmuenzenmeyer">twitter</a>
  <a href="https://github.com/bmuenzenmeyer">github</a>
  <a href="http://codepen.io/bmuenzenmeyer/">codepen</a>
  <a href="mailto:brian.muenzenmeyer@gmail.com">email</a>
</nav>


<main id="container" role="main" class="">
  <h2 class="item__heading">Adding Common Gulp Tasks to Pattern Lab Node</h2>
  <section class="article ">

  <p><br />
<em>This article only pertains to Pattern Lab Node 2.X.</em></p>

<p>With <a href="https://www.smashingmagazine.com/2016/07/building-maintaining-atomic-design-systems-pattern-lab/">Pattern Lab 2</a> released, you can now integrate with the core Pattern Lab library via <a href="http://patternlab.io/docs/advanced-ecosystem-overview.html">Editions</a>. These pre-canned project configurations are meant to be consumed, riffed off of, and made your own: unique to each project or team’s workflow.</p>

<p>At the <a href="webdesignday.com/atomic-design-workshop.html">Atomic Design / Pattern Lab Workshop at WebDesignDay</a>, one attendee asked how to integrate Sass compilation into the <a href="https://github.com/pattern-lab/edition-node-gulp">off-the-shelf gulp edition</a>.</p>

<blockquote>
  <p>History: Pattern Lab Node has for a while now not shipped any .scss files. Making decisions like this in a design system tool as configurable as Pattern Lab only boxes in users and makes it harder for them to work their own way.</p>
</blockquote>

<p>With Editions, Pattern Lab becomes, as <a href="https://twitter.com/dmolsen">Dave Olsen</a> put it, “just another task.” This means integration with a tool like sass is no different than integration you’d encounter elsewhere. This example is applicable to all sorts of tasks you might want to integrate as part of your toolchain. Let’s get started.</p>

<h2 id="adding-sass-compilation">Adding Sass Compilation</h2>

<p>The code we’ll be augmenting is within <a href="https://github.com/pattern-lab/edition-node-gulp/blob/master/gulpfile.js"><code class="highlighter-rouge">gulpfile.js</code></a>. The gulp tasks are organized into three big chunks:</p>

<ul>
  <li>Copy Tasks - responsible for shuttling front-end assets from <a href="http://patternlab.io/docs/editing-source-files.html"><code class="highlighter-rouge">source/</code></a> to <code class="highlighter-rouge">public/</code></li>
  <li>Pattern Lab Tasks - responsible for configuring and interfacing with the core pattern rendering library</li>
  <li>Server and Watch Tasks - responsible for controlling the <a href="http://patternlab.io/docs/viewing-patterns.html#node">self-hosting of the Pattern Lab front end</a> and re-generating the site on <code class="highlighter-rouge">source/</code> changes</li>
</ul>

<p>We will be adding to and editing the copy tasks.</p>

<p>To add sass compilation capabilities, you must first include the <a href="https://github.com/dlmanning/gulp-sass">gulp-sass</a> library from <a href="http://npmjs.com/">npm</a>. From a command prompt open to the root of your edition:</p>

<p><code class="highlighter-rouge">bash
npm install gulp-sass
</code></p>

<p>Once this completes, add the gulp-sass library via a require statement at the top of the gulpfile:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>  <span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp'</span><span class="p">),</span>
  <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">),</span>
  <span class="nx">browserSync</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'browser-sync'</span><span class="p">).</span><span class="nx">create</span><span class="p">(),</span>
  <span class="nx">sass</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-sass'</span><span class="p">),</span>
  <span class="nx">argv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'minimist'</span><span class="p">)(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>With sass included, we turn our attention to getting the <code class="highlighter-rouge">.scss</code> files compiled. For the sake of the demo I’ll be assuming you store the <code class="highlighter-rouge">.scss</code> files alongside <code class="highlighter-rouge">.css</code> files inside <code class="highlighter-rouge">./source/css/</code>. Our sass task will compile the <code class="highlighter-rouge">.scss</code> from this location <em>back into this location</em> so the existing css copy task picks it up.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre> <span class="c1">// SASS Compilation</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'pl-sass'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">paths</span><span class="p">().</span><span class="nx">source</span><span class="p">.</span><span class="nx">css</span><span class="p">,</span> <span class="s1">'**/*.scss'</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sass</span><span class="p">().</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">sass</span><span class="p">.</span><span class="nx">logError</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">paths</span><span class="p">().</span><span class="nx">source</span><span class="p">.</span><span class="nx">css</span><span class="p">)));</span>
<span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<blockquote>
  <p>Note: Read more about Gulp Sass configuration <a href="https://github.com/dlmanning/gulp-sass">at its Github repository</a>.</p>
</blockquote>

<p>You can test the task from the command line:</p>

<p><code class="highlighter-rouge">bash
gulp pl-sass
</code></p>

<blockquote>
  <p>Another Note: I namespace most tasks with <code class="highlighter-rouge">pl-</code> in an attempt to avoid naming conflicts.</p>
</blockquote>

<p>If everything is setup right - we see the <code class="highlighter-rouge">scss</code> compile into <code class="highlighter-rouge">css</code>. We are not done yet, however. We need to integrate our <code class="highlighter-rouge">pl-sass</code> task into the main toolchain. Critically, sass compilation needs to occur before copy of the css. Let’s look at the <code class="highlighter-rouge">pl-assets</code> task:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre> <span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'pl-assets'</span><span class="p">,</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">series</span><span class="p">(</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">parallel</span><span class="p">(</span>
    <span class="s1">'pl-copy:js'</span><span class="p">,</span>
    <span class="s1">'pl-copy:img'</span><span class="p">,</span>
    <span class="s1">'pl-copy:favicon'</span><span class="p">,</span>
    <span class="s1">'pl-copy:font'</span><span class="p">,</span>
    <span class="s1">'pl-copy:css'</span><span class="p">,</span>
    <span class="s1">'pl-copy:styleguide'</span><span class="p">,</span>
    <span class="s1">'pl-copy:styleguide-css'</span>
  <span class="p">),</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">){</span>
    <span class="nx">done</span><span class="p">();</span>
  <span class="p">})</span>
<span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>This task uses the new gulp 4.X syntax to clearly define what tasks must run in sequential order (series) versus in parallel. This task reads in plain English as: <em>When I’m told to run <code class="highlighter-rouge">pl-assets</code>, first run all the <code class="highlighter-rouge">pl-copy</code> tasks in whichever order you like, and then tell the caller when I’m done.</em></p>

<p>Something you might notice from the example is that <code class="highlighter-rouge">gulp.series()</code> and <code class="highlighter-rouge">gulp.parallel()</code> calls are “nestable.” Armed with that knowledge, we augment the task as follows:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre> <span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'pl-assets'</span><span class="p">,</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">series</span><span class="p">(</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">parallel</span><span class="p">(</span>
    <span class="s1">'pl-copy:js'</span><span class="p">,</span>
    <span class="s1">'pl-copy:img'</span><span class="p">,</span>
    <span class="s1">'pl-copy:favicon'</span><span class="p">,</span>
    <span class="s1">'pl-copy:font'</span><span class="p">,</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">series</span><span class="p">(</span><span class="s1">'pl-sass'</span><span class="p">,</span> <span class="s1">'pl-copy:css'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">){</span><span class="nx">done</span><span class="p">();}),</span>
    <span class="s1">'pl-copy:styleguide'</span><span class="p">,</span>
    <span class="s1">'pl-copy:styleguide-css'</span>
  <span class="p">),</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">){</span>
    <span class="nx">done</span><span class="p">();</span>
  <span class="p">})</span>
<span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>We’ve now ensured that <code class="highlighter-rouge">pl-sass</code> is called before <code class="highlighter-rouge">pl-copy:css</code> - while maintaining as much asynchronous processing as possible. We can test <code class="highlighter-rouge">pl-assets</code> individually if we like. Or since it’s included in the <code class="highlighter-rouge">patternlab:build</code> task, we know the task will run with existing Pattern Lab commands.</p>

<p>The last thing we have to do is still gulp to re-run our <code class="highlighter-rouge">pl-sass</code> task after every <code class="highlighter-rouge">.scss</code> file change. Add the following to the <code class="highlighter-rouge">watch()</code> function:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre> <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">paths</span><span class="p">().</span><span class="nx">source</span><span class="p">.</span><span class="nx">css</span><span class="p">,</span> <span class="s1">'**/*.scss'</span><span class="p">)).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">series</span><span class="p">(</span><span class="s1">'pl-sass'</span><span class="p">));</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>With this in place the entire build chain will fire every time you save a sass file.</p>

<p>For simplicity’s sake, the complete altered gulpfile can be found here: <a href="https://gist.github.com/bmuenzenmeyer/7a6ec54dc1ea720a61497a75ea88e3b4">https://gist.github.com/bmuenzenmeyer/7a6ec54dc1ea720a61497a75ea88e3b4</a> and is current as of Edition Node Gulp ~<code class="highlighter-rouge">1.3.0</code></p>

<p>I hope that this short post demystifies what it takes to grab a copy of Pattern Lab 2 and hack it up! We’ve spent a lot of time making an ecosystem that is flexible, extensible, and ready for you and your teams to make it your own.</p>

<p>And as always, please give us feedback, no matter how small. Spot a typo in the docs, or this post, or think a feature would be killer? Let us know.</p>

<ul>
  <li><a href="https://gitter.im/pattern-lab/general">Chat with us gitter</a>.</li>
  <li><a href="https://twitter.com/bmuenzenmeyer">Tell me on Twitter what you are building with Pattern Lab Node!</a></li>
  <li><a href="https://twitter.com/patternlabio">Follow the official Pattern Lab account for the latest news</a></li>
</ul>


</section>

<section>

  <div class="meta">Originally posted 07/21/16 - <a href="https://twitter.com/bmuenzenmeyer">Brian Muenzenmeyer - Follow me on Twitter</a></div>


  <div class="postNav buttons buttons_secondary">

<a href="//pattern-lab-yes-and" title="Pattern Lab. Yes, and...">Newer Post<br/>Pattern Lab. Yes, and...</a>



<a href="//pattern-lab-2" title="Pattern Lab 2">Older Post<br/>Pattern Lab 2</a>

</div>


  <link rel="stylesheet" href="http://bmuenzenmeyer.github.io/css/code.css">

</section>

</main>

<script>
    //Please change this if you fork the repo!
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='//www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-29672680-1','auto');ga('send','pageview');
</script>
</body>
</html>
